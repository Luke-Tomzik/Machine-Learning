#Practicing LASSO
#installing the baseball dataset I want to practice on. I needed the ! in front of the pip since I am using Colab 
#!pip install pybaseball
#Installing the libraries I want to use 
import pandas as pd
import numpy as np
from pybaseball import batting_stats
from sklearn.linear_model import LassoCV
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import mean_squared_error, r2_score

#Loading in my data for a 10 year span 
df = batting_stats(2014,2023)
#checking out the data 
print(df.columns.tolist())
#Chosing my features for my predictors 
predictors=['AB','H','AVG','OBP','SLG','Clutch','ISO','HardHit','Age']
#Removing missing values from my dataset
ml_data=df[predictors+['HR']].dropna()
#Making my prediction and my response 
x=ml_data[predictors]
y=ml_data['HR']
#Doing my testing and training split 
x_train,x_test,y_train,y_test=train_test_split(x,y,test_size=0.2,random_state=22)
#Now I'm going to scale my data 
scaled=StandardScaler()
x_train=scaled.fit_transform(x_train)
x_test=scaled.transform(x_test)
#Performing my lasso
# LassoCV automatically finds the best alpha
lasso = LassoCV(alphas=np.logspace(-3, 1, 50), cv=5,max_iter=100000)
lasso.fit(x_train, y_train)
#Getting my alpha value 
print("Alpha",lasso.alpha_)
#Evaluating my model 
y_pred = lasso.predict(x_test)
print("RÂ²:", round(r2_score(y_test, y_pred), 3))
print("RMSE:", round(np.sqrt(mean_squared_error(y_test, y_pred)), 3))
#Seeing which features were most import 
coef_df = pd.DataFrame({
    'Feature': predictors,
    'Coefficient': lasso.coef_
}).sort_values('Coefficient', key=abs,ascending=False)
print(coef_df)
